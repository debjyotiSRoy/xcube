#!/bin/bash

# Include the parameter parsing function
source param_parser.sh

# Initialize parameters with default values
fname="mimic4_icd10_l2r"
model_algo="lin_lambdarank"

# Parse named parameters
parse_params "$@"

# Print params passed
echo "fname is: $fname"
echo "model_algo is: $model_algo"

export OMP_NUM_THREADS=4
# accelerate launch --mixed_precision=fp16 --num_processes=1 \
python -m pdb \
                                    train_l2r.py \
                                    --source_url="XURLs.MIMIC4_L2R" \
                                    --data="mimic4_icd10_tok_lbl" \
                                    --epochs=20 \
                                    --bs=64 \
                                    --lbs_chunks=4 \
                                    --sl=64 \
                                    --lr=3e-2 \
                                    --model_algo=$model_algo \
                                    --emb_sz=400 \
                                    --fname=$fname \
                                    --track_train \
                                    --infer=0 \
                                    --log \
                                    --trn_frm_cpt
echo "files created:"
find ../tmp -name "$fname*" 